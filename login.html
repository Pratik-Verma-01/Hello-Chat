<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Hello Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#13ec5b", "background-dark": "#102216" },
                    fontFamily: { "display": ["Plus Jakarta Sans", "sans-serif"] }
                }
            }
        }
    </script>
</head>
<body class="bg-background-dark font-display text-white flex flex-col h-screen p-6 justify-center">

    <div class="w-full max-w-md mx-auto">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 id="pageTitle" class="text-3xl font-bold mb-2">Welcome Back</h1>
            <p id="pageSubtitle" class="text-gray-400 text-sm">Login to continue chatting.</p>
        </div>

        <!-- Form -->
        <div class="flex flex-col gap-4">
            
            <!-- Email -->
            <div>
                <label class="text-sm text-primary font-medium ml-1">Email</label>
                <input id="email" type="email" placeholder="name@example.com" 
                       class="w-full bg-[#1A2B20] border border-gray-600 text-white p-4 rounded-xl focus:border-primary focus:outline-none">
            </div>

            <!-- Password -->
            <div>
                <label class="text-sm text-primary font-medium ml-1">Password</label>
                <input id="password" type="password" placeholder="••••••••" 
                       class="w-full bg-[#1A2B20] border border-gray-600 text-white p-4 rounded-xl focus:border-primary focus:outline-none">
            </div>

            <!-- Confirm Password (Hidden initially) -->
            <div id="confirmDiv" class="hidden">
                <label class="text-sm text-primary font-medium ml-1">Confirm Password</label>
                <input id="confirmPassword" type="password" placeholder="••••••••" 
                       class="w-full bg-[#1A2B20] border border-gray-600 text-white p-4 rounded-xl focus:border-primary focus:outline-none">
            </div>

            <!-- Action Button -->
            <button onclick="handleAuth()" id="authBtn"
                    class="w-full bg-primary text-black font-bold text-lg p-4 rounded-full mt-4 shadow-lg active:scale-95 transition-transform">
                Login
            </button>

            <!-- Toggle Mode -->
            <p class="text-center text-gray-400 text-sm mt-4 cursor-pointer hover:text-white" onclick="toggleMode()">
                <span id="toggleText">New here? Create an account</span>
            </p>
        </div>
    </div>

    <script src="supabase-config.js"></script>
    <script>
        let isSignup = false;

        function toggleMode() {
            isSignup = !isSignup;
            const title = document.getElementById('pageTitle');
            const sub = document.getElementById('pageSubtitle');
            const btn = document.getElementById('authBtn');
            const toggle = document.getElementById('toggleText');
            const confirmDiv = document.getElementById('confirmDiv');

            if (isSignup) {
                title.innerText = "Create Account";
                sub.innerText = "Sign up to get started.";
                btn.innerText = "Sign Up";
                toggle.innerText = "Already have an account? Login";
                confirmDiv.classList.remove('hidden');
            } else {
                title.innerText = "Welcome Back";
                sub.innerText = "Login to continue chatting.";
                btn.innerText = "Login";
                toggle.innerText = "New here? Create an account";
                confirmDiv.classList.add('hidden');
            }
        }

        async function handleAuth() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirm = document.getElementById('confirmPassword').value.trim();
            const btn = document.getElementById('authBtn');

            if (!email || !password) return alert("Please fill all fields");
            if (password.length < 6) return alert("Password must be at least 6 characters");

            btn.innerText = "Processing...";
            btn.disabled = true;

            if (isSignup) {
                // --- SIGN UP LOGIC ---
                if (password !== confirm) {
                    btn.innerText = "Sign Up";
                    btn.disabled = false;
                    return alert("Passwords do not match!");
                }

                const { data, error } = await window.supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) {
                    alert(error.message);
                    btn.innerText = "Sign Up";
                    btn.disabled = false;
                } else {
                    // Success -> Go to Profile Setup
                    window.location.href = 'profile_setup.html';
                }

            } else {
                // --- LOGIN LOGIC ---
                const { data, error } = await window.supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    alert("Login Failed: " + error.message);
                    btn.innerText = "Login";
                    btn.disabled = false;
                } else {
                    // Success -> Go to Home
                    window.location.href = 'home.html';
                }
            }
        }
    </script>
</body>
</html>
